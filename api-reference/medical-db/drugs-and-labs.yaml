openapi: 3.0.1
info:
  title: Eka Care Drugs and Labs API
  description: API for searching pharmaceutical drugs and laboratory tests
  version: 1.0.0
servers:
  - url: https://api.eka.care/medical-db/v1
    description: Production server
  - url: https://api.dev.eka.care/medical-db/v1
    description: Development server
paths:
  /drugs-and-labs:
    get:
      summary: Search for drugs and laboratory tests
      description: |
        Search for pharmaceutical drugs and laboratory tests based on query parameters. 
        This API provides comprehensive information about medicines including manufacturer details, 
        dosage information, generic names, and availability across different pharmacy platforms.

        **Search Features:**
        - **Drug Search:** Find medicines by brand name, generic name, or manufacturer
        - **Lab Test Search:** Search for laboratory tests and diagnostic procedures
        - **Multi-platform Mapping:** Check availability on 1mg, MedPay, and other platforms
        - **Detailed Information:** Get complete drug information including dosage, packaging, and OTC status
      operationId: searchDrugsAndLabs
      parameters:
        - name: q
          in: query
          required: true
          description: Search query string for drugs or lab tests
          schema:
            type: string
            minLength: 1
            maxLength: 100
          example: "dolo"
        - name: limit
          in: query
          required: false
          description: Maximum number of results to return
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          example: 16
        - name: s_type
          in: query
          required: false
          description: Type of search to perform
          schema:
            $ref: '#/components/schemas/SearchType'
      responses:
        '200':
          description: Successful response with drugs and lab tests
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
              example:
                drugs:
                  - id: "b-4117370658"
                    name: "Dolo 650 Tablet"
                    manufacturer_name: "Micro Labs Ltd"
                    product_type: "Tablet"
                    product_sku: "15 tablets in 1 strip"
                    generic_name: "Paracetamol (650mg)"
                    generic_id: "g-3283555471"
                    dosage:
                      unit: "tablet"
                      unit_name: "tablet"
                      unit_id: "du-5550260779"
                      dosage: "1-1-1"
                      dosage_form: "tablet"
                      df_id: "df-2929601942"
                      days: "5"
                      food: "SF"
                    action_class: {}
                    common_name: "Dolo 650 Tablet"
                    soa: false
                    hxng_mapped: "yes"
                    hxng_status: "available"
                    mapping_status:
                      onemg_mapped: "yes"
                      medpay_mapped: "yes"
                    api_key: ""
                    drug_name_match: true
                    is_cerebro_verified: false
                    include_suggestion: false
                    highlighted_fields: {}
                lab_tests: []
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Invalid search parameters"
                code: 400
                details: "Query parameter 'q' is required"
        '404':
          description: No results found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
              example:
                drugs: []
                lab_tests: []
        '429':
          description: Too many requests - rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Rate limit exceeded"
                code: 429
                details: "Maximum 100 requests per minute allowed"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Internal server error"
                code: 500
                details: "An unexpected error occurred"

components:
  schemas:
    SearchType:
      type: string
      description: |
        Type of search to perform. Controls which categories to search within:
        - `drug`: Search for pharmaceutical drugs and medicines
        - `medicine`: Alias for drug search
        - `lab`: Search for laboratory tests and diagnostic procedures
      enum:
        - drug
        - medicine
        - lab
      default: drug
      example: "drug"

    SearchResponse:
      type: object
      properties:
        drugs:
          type: array
          items:
            $ref: '#/components/schemas/Drug'
          description: Array of drug objects matching the search criteria
        lab_tests:
          type: array
          items:
            $ref: '#/components/schemas/LabTest'
          description: Array of laboratory test objects matching the search criteria
      required:
        - drugs
        - lab_tests

    Drug:
      type: object
      properties:
        id:
          type: string
          description: Unique identifier for the drug
          example: "b-4117370658"
        name:
          type: string
          description: Commercial name of the drug
          example: "Dolo 650 Tablet"
        manufacturer_name:
          type: string
          description: Name of the manufacturing company
          example: "Micro Labs Ltd"
        product_type:
          type: string
          description: Type/form of the product
          example: "Tablet"
        product_sku:
          type: string
          description: Product packaging information
          example: "15 tablets in 1 strip"
        generic_name:
          type: string
          description: Generic/chemical name with dosage
          example: "Paracetamol (650mg)"
        generic_id:
          type: string
          description: Unique identifier for the generic compound
          example: "g-3283555471"
        dosage:
          $ref: '#/components/schemas/Dosage'
        action_class:
          type: object
          description: Drug action classification
          additionalProperties: true
        common_name:
          type: string
          description: Commonly used name for the drug
          example: "Dolo 650 Tablet"
        soa:
          type: boolean
          description: Schedule of Administration flag
          example: false
        hxng_mapped:
          type: string
          enum: [yes, no]
          description: HXNG mapping status
          example: "yes"
        hxng_status:
          type: string
          enum: [available, "not available"]
          description: HXNG availability status
          example: "available"
        mapping_status:
          $ref: '#/components/schemas/MappingStatus'
        api_key:
          type: string
          description: Associated API key
          example: ""
        drug_name_match:
          type: boolean
          description: Whether drug name matches search query
          example: true
        is_cerebro_verified:
          type: boolean
          description: Cerebro verification status
          example: false
        include_suggestion:
          type: boolean
          description: Whether to include in suggestions
          example: false
        highlighted_fields:
          type: object
          description: Fields to highlight in search results
          additionalProperties: true
        is_otc:
          type: boolean
          description: Over-the-counter availability
          example: true
      required:
        - id
        - name
        - manufacturer_name
        - product_type
        - generic_name
        - generic_id
        - common_name
        - soa
        - hxng_mapped
        - hxng_status
        - drug_name_match
        - is_cerebro_verified
        - include_suggestion

    Dosage:
      type: object
      properties:
        unit:
          type: string
          description: Dosage unit
          example: "tablet"
        unit_name:
          type: string
          description: Human-readable unit name
          example: "tablet"
        unit_id:
          type: string
          description: Unique identifier for the unit
          example: "du-5550260779"
        dosage:
          type: string
          description: Dosage frequency (times per day)
          example: "1-1-1"
        dosage_form:
          type: string
          description: Form of the medication
          example: "tablet"
        df_id:
          type: string
          description: Dosage form identifier
          example: "df-2929601942"
        days:
          type: string
          description: Duration of treatment in days
          example: "5"
        food:
          type: string
          description: Food relation (SF = Sugar Free, etc.)
          example: "SF"

    MappingStatus:
      type: object
      properties:
        onemg_mapped:
          type: string
          enum: [yes, no]
          description: 1mg platform mapping status
          example: "yes"
        medpay_mapped:
          type: string
          enum: [yes, no]
          description: MedPay platform mapping status
          example: "yes"
      required:
        - onemg_mapped
        - medpay_mapped

    LabTest:
      type: object
      description: Laboratory test information
      properties:
        id:
          type: string
          description: Unique identifier for the lab test
        name:
          type: string
          description: Name of the laboratory test
        description:
          type: string
          description: Description of the test
        category:
          type: string
          description: Test category
        price:
          type: number
          description: Test price
        preparation:
          type: string
          description: Pre-test preparation instructions

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error message
          example: "Invalid search parameters"
        code:
          type: integer
          description: Error code
          example: 400
        details:
          type: string
          description: Additional error details
      required:
        - error
        - code