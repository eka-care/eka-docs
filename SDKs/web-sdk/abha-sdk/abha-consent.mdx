---
title: ABHA Consent Management
description: "Complete implementation guide for the ABHA SDK to be used for ABHA Consent Management Flow."
---


# ABHA SDK - Consent Management Implementation

This guide provides everything you need to integrate the ABHA SDK into your application for ABHA Consent Management.
- **ABHA Consent Management**: Manage Consent requests raised by healthcare providers to share medical records securely.

### Implementation Example

Add the following HTML and script tags to your webpage:

```html
<!DOCTYPE html>
<html>
  <head>
    <title>ABHA SDK Integration for ABHA Consent Management</title>

    <!-- Include ABHA SDK CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/@eka-care/abha/dist/sdk/abha/css/abha.css"
    />
  </head>
  <body>
    <h1>ABHA SDK Demo</h1>

    <!-- Mount Button -->
    <button class="button" onclick="mountABHASDK()">Mount SDK</button>

    <!-- Container for ABHA SDK -->
    <div id="sdk_container"></div>

    <!-- Include ABHA SDK JS -->
    <script
      type="module"
      src="https://unpkg.com/@eka-care/abha/dist/sdk/abha/js/abha.js"
    ></script>

    <script>
      function mountABHASDK() {
        window.initAbhaApp({
          containerId: "sdk_container",
          clientId: 'ext',

         // Pass the data here: 
          data: {
             accessToken: '<available_access_token>', // Pass the access token you have without Bearer prefix
             oid: '<patient_oid>', // Pass Patient OID
             hipId:'<available_HFR_ID>', // Pass the HFR ID you have
             identifier:'abc@abdm', // Pass the phr address as identifier
             identifier_type:"phr_address",  // Pass the identifier type i.e. "phr_address"
             consent_id: '<consent_id_of_the_consent_raised>' // Pass the consent id of the consent request raised by the healthcare provider
             flow:'consent', // Pass the flow as consent
             linkToOrgIcon: "<url_of_image_to_link_abha_to_your_org>", // Pass the url of an image which depicts linking abha to your organisation for ex https://cdn.eka.c
             skipABHAEnable:"<boolean_value_here>" // Pass boolean as true if you want Skip ABHA button to be enabled on login screen
          },

          //Consent Successs callback
          onConsentSuccess: (params) => {
            console.log("ABHA Consent flow completed successfully:", params);
            
            // Example: Store ABHA data in your app
            if (window.EkaAbha) {
              window.EkaAbha.onAbhaConsentSuccess(JSON.stringify(params));
            }
          },

          // Error callback
          onError: (params) => {
            console.error("ABHA SDK failed:", params);

            // Example: Store ABHA data in your app
            if (window.EkaAbha) {
              window.EkaAbha.onAbhaFailure(JSON.stringify(params));
            }
          },

          // Abha Close callback
          onAbhaClose: () => {
            console.log("ABHA SDK closed");
          },
          
          // Skip ABHA callback
          onSkipAbha: (params) => {
            console.log("ABHA flow SKIPPED:", params);
          },
        });
      }
    </script>
  </body>
</html>
```
## Core Functions

### 1. initAbhaApp

Initializes and renders the ABHA SDK in your specified container.

**Parameters:**

| Name          | Type                                    | Required    | Description                                                                                                                                    |
| ------------- | --------------------------------------- | ----------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| `containerId` | `string`                                | ✅           | The HTML element ID where the SDK will mount.                                                                                                  |
| `clientId` | `string`                                | ✅           | Provide clientId as `ext`.                                                                                                  |
| `data` | `{`<br/>`accessToken: string;`<br/>`oid?: string;`<br/> `hipId?: string;`<br/>`identifier: string;`<br/>`identifier_type: string;`<br/>`consent_id: string;`<br/>`flow: string;`<br/>`linkToOrgIcon?: string;`<br/>`skipABHAEnable?: boolean;`<br/>`}` | ⚙️ Optional | Configuration data for initializing the ABHA flow.<br/>- <strong>accessToken:</strong> Pass the access token you have generated from [Connect Login ](https://developer.eka.care/api-reference/authorization/client-login) API without the word `Bearer`.<br/>- <strong>oid:</strong> Pass the OID of the patient if available. <br/>- <strong>hipId:</strong> Pass the HFR ID you have.<br/>- <strong>identifier:</strong> Pass the identifier value i.e. phr address to get it kyced.<br/>- <strong>identifier_type:</strong> Pass the type of identifier which you passed in `identifier` key i.e. "phr_address". <br/>- <strong>consent_id:</strong> Pass the consent_id of the consent request raised. <br/>- <strong>flow:</strong> Pass the type of flow for which you want to use SDK for i.e. `consent` for Consent flow. <br/>- <strong>linkToOrgIcon:</strong> Public CDN URL of the icon representing “Link ABHA to your organisation” url should start with https://. [Example](https://cdn.eka.care/vagus/cm6agrs5000090tfwfz984x5b.webp) <br/>- <strong>skipABHAEnable:</strong> Pass the boolean as true if you want Skip ABHA button to be enabled on login screen.<br/> <br/> `keys with ? are optional.` |
| `onConsentSuccess`   | `(params: TOnAbhaConsentSuccessParams) => void`   | ✅           | Triggered when the consent flow completes successfully.
| `onError`     | `(params: TOnAbhaFailureParams) => void`     | ✅           | Triggered when an error occurs during the ABHA flow.       
| `onAbhaClose`     | `() => void`     | ✅           | Triggered when SDK closes.                                                                                           |
| `onSkipAbha`   | `(params: TOnSkipABHA) => void`   | ⚙️ Optional | Triggered if the ABHA flow is skipped.                                                                                       |                                                                                    |                                                                                 |

**Example:**

```javascript
window.initAbhaApp({
  containerId: "sdk_container",
  data: {
    accessToken: "your_access_token_here",
    oid: "patient_oid_here",
    hipId:"available_HFR_ID",
    identifier: "phr_address_of_the_patient"
    identifier_type: "phr_address"
    consent_id: "id_of_the_consent_raised_by_healthcare_provider"
    flow: "consent"
    linkToOrgIcon: "url_of_image_to_link_abha_to_your_org",
    skipABHAEnable: "boolean_value_here"
  },
  onConsentSuccess: (params) => {
    console.log("ABHA consent flow completed successfully!", params);
  },
  onError: (error) => {
    console.error("ABHA flow failed:", error);
  },
  onAbhaClose: (error) => {
    console.error("ABHA SDK closed");
  },
  onSkipAbha: (params) => {
    console.log("ABHA flow skipped by user:", params);
  },
});
```

## Callback Parameters


### onConsentSuccess Callback

The onConsentSuccess callback is triggered when the ABHA Consent flow completes successfully. 
It returns a confirmation message indicating that the Consent flow ended successfully.

**Callback Signature:**

```typescript
onConsentSuccess: (params: TOnAbhaConsentSuccessParams) => void;
```

**Type Definitions**

```typescript
type TOnAbhaConsentSuccessParams = string;
```

**Parameters**
|         | Type                    | Description                                                                                                |
| ---------- | ----------------------- | ---------------------------------------------------------------------------------------------------------- |
| `TOnAbhaConsentSuccessParams` | `string` | A confirmation message from SDK post Consent flow completion |



**Example:**

```javascript
const onConsentSuccess = (params) => {
  console.log("Consent Flow completed:", params);

  alert("Consent flow completed successfully!");

  // Optionally pass data to native bridge if available
  if (window.EkaAbha) {
    window.EkaAbha.onAbhaConsentSuccess(params);
  }
};
```

### onError Callback
The onError callback is triggered whenever an ABHA flow fails or is interrupted.
It provides details about the failure through structured parameters, allowing you to handle or forward the error appropriately (for example, to native apps or monitoring tools).

**Callback Signature:**

```typescript
onError: (params: TOnAbhaFailureParams) => void;
```

**Type Definitions**

```typescript
type TOnAbhaFailureParams = {
  error?: string;
  response?: TAuthVerifyV2Response;
};

type TAuthVerifyV2Response = {
  skip_state: number;
  method: AUTH_METHOD;
  data?: {
    tokens: {
      sess: string;
      refresh: string;
    };
    profile: TProfileRecord;
  };
  txn_id: string;
  error?: {
    code: number;
    message: string;
  };
};

enum AUTH_METHOD {
  EMAIL = 1,
  MOBILE = 2,
  ABHA = 7,
}

type TProfileRecord = {
  fln: string;
  fn: string;
  mn?: string;
  ln?: string;
  gen?: "M" | "F" | "O" | "U" | undefined; // 'male' | 'female' | 'other' | 'unknown'
  dob?: string;
  mobile?: string;
  email?: string;
  uuid?: string;
  bloodgroup?: "" | "A+" | "A-" | "B+" | "B-" | "O+" | "O-" | "AB+" | "AB-";
  pic?: string;
  as?: string;
  "dob-valid"?: boolean;
  "is-d"?: boolean;
  "is-d-s"?: boolean;
  "is-p"?: boolean;
  oid: string;
  at: string;
  type?: 1 | 2 | 3 | 4 | 5 | 6;
  "health-ids"?: Array<string>;
  abha_number?: string;
  kyc_verified?: boolean;
};

```

**Parameters**
| Key        | Type                     | Description                                                      |
| ---------- | ------------------------ | ---------------------------------------------------------------- |
| `error`    | `string?`                | Short description of the failure or error message.               |
| `response` | `TAuthVerifyV2Response?` | Partial or full API response object returned from ABHA services. |


**Example:**

```javascript
const onError = (params) => {
  console.error("ABHA Error:", params);

  if (params.response?.error?.code === 1001) {
    alert("Authentication failed. Please try again.");
  } else if (params.error === "NETWORK_ERROR") {
    alert("Please check your internet connection.");
  } else {
    alert("Something went wrong. Please retry.");
  }

  // Forward the error to native handler if available
  if (window.EkaAbha) {
    window.EkaAbha.onAbhaFailure(JSON.stringify(params));
  }
};
```

### onAbhaClose Callback

The onAbhaClose callback is triggered when the ABHA SDK flow gets closed. 

**Callback Signature:**

```typescript
onAbhaClose: () => void;
```

**Example:**

```javascript
const onAbhaClose = () => {
  console.log("ABHA SDK Closed");
};
```

### onSkipAbha Callback

The onSkipAbha callback is triggered when the ABHA SDK flow is skipped. The callback is functional when skipABHAEnable is set to true in the data parameter while initializing the SDK.

**Callback Signature:**

```typescript
onSkipAbha: (params: TOnSkipABHA) => void;
```

**Example:**

```javascript
const onSkipAbha = (params) => {
  console.log("ABHA SDK Skipped:", params);
};
```
**Type Definitions**

```typescript
 type IdentifierType = "mobile" | "aadhaar_number" | "abha_number" | "phr_address";

 type TOnSkipABHA = {
  identifier?: string;
  identifier_type?: IdentifierType[]; // No default value here
};
```

**Parameters**
| Key        | Type                     | Description                                                      |
| ---------- | ------------------------ | ---------------------------------------------------------------- |
| `identifier`    | `string?`                | It will be login identifier value filled by user.               |
| `identifier_type` | `IdentifierType[]?` | It will be type of login identifier. |

**Suggest Handling**
-Always log the full error response (params) for debugging.
-Display friendly error messages for known error.code values.
-If params.response is present, inspect response.error.message for more detail.
-If integrating with native apps, forward the serialized error object:
```javascript
window.EkaAbha.onAbhaFailure(JSON.stringify(params));
```

**Suggest Handling**
-Always log the full error response (params) for debugging.
-Display friendly error messages for known error.code values.
-If params.response is present, inspect response.error.message for more detail.
-If integrating with native apps, forward the serialized error object:
```javascript
window.EkaAbha.onAbhaFailure(JSON.stringify(params));
```

## Container Styling
Ensure your container has sufficient space:
```html
<div
  id="sdk_container"
  style="width: 100%; height: 600px; border: 1px solid #ddd;"
></div>
```

## Troubleshooting

### Common Issues

#### 1. SDK Not Rendering

**Problem**: Nothing appears in the container.

**Solution**:
- Ensure containerId matches an existing HTML element.
- Verify the SDK JS and CSS are correctly loaded.
- Check browser console for errors.

#### 2. APIs Not Being Called

**Problem**: API requests are not triggered after the SDK is mounted.

**Solution**:
- Ensure that the accessToken is passed correctly (do not include the Bearer prefix) and that the token has not expired.
- To prevent CORS-related issues, ensure that your domain is whitelisted.

#### 3. Callback Not Triggered

**Problem**: onSuccess, onError, onKYCSuccess, onConsentSuccess, onAbhaClose isn’t firing.

**Solution**:
- Make sure callbacks are passed as valid functions.
- Avoid race conditions (e.g., calling before SDK fully loads).

#### 4. Styling Issues

**Problem**: SDK content appears misaligned or clipped.

**Solution**:
- Give your container a fixed height (e.g., 600px).
- Ensure no parent element uses overflow: hidden.

